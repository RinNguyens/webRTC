<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Demo</title>
  <link rel="stylesheet" href="style.css" type="text/css" media="all">
</head>

<body>
  <div id="wrapper">
    <section id="contents">
      <!-- カメラ映像 -->

      <video id="camera" autoplay muted playsinline></video>

      <div id="shadow">
      </div>

      <div id="detail">
        <div class="wrapTitle">
          <p class="title">Watch Master</p>
          <img src="image/bannerTop.png" class="bannerTop" />
        </div>
        <img src="icon/detail.png" id="show-Detail" class="detailImg" />
      </div>
      <div id="product">
        <p id="ref" class="name">SNE-123-123</p>
        <p id="brand-name" class="product-overview">カメラ映像カメラ映像カメラ映像</p>
        <div class="product-detail">
          <p id="case_size" class="size">Case size: 41.0mm</p>
          <p id="price" class="tax">Y682,200 (tax inc.)</p>
        </div>
      </div>

      <div id="hand">
        <img src="icon/hand.png" width="100%" height="100%" />
      </div>
      <!-- フレーム -->
      <div id="detailWatch">
        <div style="margin-left: 30px;">
          <img src="image/detailWatch.png" class="notiWatch" />
        </div>
        <div style="transform: skew(10deg);">
          <canvas id="frame" width="310" height="310"></canvas>
        </div>
      </div>

      <!-- シャッター -->
      <div id="shutter-inner">
        <div class="container-shutter">
          <img src="image/shutterDetail.png" class="shutter-detail" />
        </div>
        <button id="btn-shutter" type="button"><img src="icon/camera-solid.png" width="200" height="200"></button>
      </div>

      <!-- フレーム切り替え -->
      <div id="frame-inner" style="display: none;">
        <h2>フレーム切り替え</h2>
        <ul id="framelist">
        </ul>
      </div>
    </section>

    <!-- 合成用Canvas(不可視) -->
    <canvas id="still" width="700" height="1000"></canvas>

    <!-- ダイアログ -->
    <div id="dialog-outer">
      <!-- 最終結果 -->
      <div id="dialog-result" class="dialog">
        <p>
          <img id="dialog-result-close" src="icon/times-circle-regular.png" width="48" height="48">
        </p>
        <div id="wrapImg">

          <!-- <canvas id="resultImg" width="762" height="1680"></canvas> -->
          <div id="resultImg">
            <div>
              <div id="detail-modal">
                <div class="wrapTitle-modal">
                  <p class="title-modal">Watch Master</p>
                  <img src="image/bannerTop.png" class="bannerTop" style="display: none;" />
                </div>
                <img src="icon/detail.png" id="show-Detail" class="detailImg-modal" style="display: none;" />
              </div>
              <p class="hr-modal"></p>
              <div id="product-modal">
                <p id="ref-modal" class="name-modal">SBGA211</p>
                <p id="brand-name-modal" class="product-overview-modal">カメラ映像カメラ映像カメラ映像</p>
                <div class="product-detail-modal">
                  <p id="case_size-modal" class="size-modal">Case size: 41.0mm</p>
                  <p id="price-modal" class="tax-modal">Y682,200 (tax inc.)</p>
                </div>
              </div>
            </div>
            <div id="shadowModal"></div>
            <div>
              <canvas id="frameResult"></canvas>
            </div>
            <img id="photo" />
          </div>

        </div>
        <div id="content-detail">
          <div id="fitting">
            <h1>VIRTUAL FITTING APP</h1>
          </div>
          <div id="list-content">
            <div class="link item">
              <img src="icon/camera-solid.png" class="item-img" />
              <div class="base">
                <h2>LINK</h2>
                <div class="base-text">
                  <p>最終結果最終結果最終結果最終結果</p>
                  <p>最終結果最終結果最終結果最終結果</p>
                </div>
              </div>
            </div>
            <div class="scale item">
              <img src="icon/pinchin.png" class="item-img" />
              <div class="base">
                <h2>SCALE</h2>
                <div class="base-text">
                  <p>最終結果最終結果最終結果最終結果</p>
                  <p>最終結果最終結果最終結果最終結果</p>
                </div>
              </div>
            </div>
            <div class="camera item">
              <img src="icon/genta.png" class="item-img" />
              <div class="base">
                <h2>CAMERA</h2>
                <div class="base-text">
                  <p>最終結果最終結果最終結果最終結果</p>
                  <p>最終結果最終結果最終結果最終結果</p>
                </div>
              </div>
            </div>
          </div>
          <div id="phone-number">
            <p><a href="tel:0522642681">
                <img src="image/phone.png" class="phone" />
              </a></p>
            <p>
              <img src="image/home.png" class="home" />
            </p>

          </div>
        </div>
        <div class="btnBottom" id="download">
          <button id="dialog-result-dl" type="button">
            <img src="icon/download-solid.png" width="48" height="48">
          </button>
        </div>
      </div>

      <!--  NowLoading -->
      <div id="dialog-nowloading" class="dialog">
        ...Now Loading
      </div>
    </div>
    <!-- /ダイアログ -->

    <audio id="se" preload="auto">
      <source src="se/camera-shutter1.mp3" type="audio/mp3">
    </audio>

  </div>
  <script type="module">
    // import dataJson from "./ar-watch.json" assert { type: "json" };
    // const watch = dataJson[0];
    // console.log(watch);
    // global vars : canvas, scroll & scale
    let info = document.getElementById("info");
    const canvas = document.getElementById("frame");
    // const idZoom = document.querySelector("#frame");
    canvas.width = 310;
    canvas.height = 310;
    let scale = 1;
    let defaultValue = 0;
    let otherValue = 0;

    let imageElementScale = 1;

    let start = {};

    // Calculate distance between two fingers
    const distance = (event) => {
      return Math.hypot(event.touches[0].pageX, event.touches[0].pageY);
    };

    canvas.addEventListener('touchstart', (event) => {
      if (event.touches.length === 1) {
        event.preventDefault(); // Prevent page scroll

        // Calculate where the fingers have started on the X and Y axis
        start.x = event.touches[0].pageX;
        start.y = event.touches[0].pageY;
        start.distance = distance(event);
      }
    });

    canvas.addEventListener('touchmove', (event) => {
      // console.log('touchmove', event);
      if (event.touches.length === 1) {
        event.preventDefault(); // Prevent page scroll
        // Safari provides event.scale as two fingers move on the screen
        // For other browsers just calculate the scale manually
        if (event.scale) {
          scale = event.scale;
        } else {
          const deltaDistance = distance(event);
          scale = deltaDistance / start.distance;
        }
        // Calculate how much the fingers have moved on the X and Y axis
        const deltaX = ((event.touches[0].pageX)) * 1; // x2 for accelarated movement
        const deltaY = ((event.touches[0].pageY)) * 1; // x2 for accelarated movement
        getDefaultDetailtY(deltaY);
        // Transform the image to make it grow and move with fingers
        // const scale 
        if (deltaY < defaultValue) {
          // Zoom in
          console.log('Zoom in');
          scale = scale - 0.2;

        } else {
          // Zoom out
          console.log('Zoom out');
          scale = scale + 0.2;;
        }

        imageElementScale = Math.min(Math.max(0.5, scale), 4);
        // Restrict scale
        // scale = Math.min(Math.max(0.5, scale), 2);
        const el = document.querySelector("#frame");
        el.style.transform = `scale(${imageElementScale})`;
        el.style.WebkitTransform = `scale(${imageElementScale})`;
        el.style.zIndex = "9999";
      }
    });

    function getDefaultDetailtY(deltaXValue) {
      if (deltaXValue > 0 && defaultValue <= 0) {
        return defaultValue = deltaXValue;
      }

      return otherValue = deltaXValue;
    }
  </script>
  <script src="util.js" type="text/javascript"></script>
  <script src="html2canvas.min.js"></script>
  <script src="main.js" type="text/javascript"></script>
</body>

</html>
</body>

</html>